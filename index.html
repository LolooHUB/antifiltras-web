<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAEUOzOWdq0xs3qiIlX1RzB6bpKkkMLykA",
        authDomain: "antifiltras-7116d.firebaseapp.com",
        projectId: "antifiltras-7116d",
        appId: "1:795745598666:web:72b77816d3c2a3c17f8833"
    };

    try {
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Referencia exacta al documento
        const docRef = doc(db, "BOT_CONTROL", "settings");

        onSnapshot(docRef, (docSnap) => {
            if (docSnap.exists()) {
                const data = docSnap.data();
                console.log("Datos recibidos:", data); // Mira esto en F12
                
                const mapping = {
                    'status-tickets': data.ticketsEnabled,
                    'status-bans': data.bansEnabled,
                    'status-config': data.configEnabled
                };

                for (const [id, val] of Object.entries(mapping)) {
                    const el = document.getElementById(id);
                    if (!el) continue;
                    const circle = el.querySelector('.circle-icon');
                    const desc = el.querySelector('.service-desc');

                    if (val === 1) {
                        circle.className = 'circle-icon green-bg';
                        desc.innerText = 'NORMAL';
                        desc.style.color = '#00ff88';
                    } else if (val === 2) {
                        circle.className = 'circle-icon yellow-bg';
                        desc.innerText = 'MANTENIMIENTO';
                        desc.style.color = '#ffcc00';
                    } else {
                        circle.className = 'circle-icon red-bg';
                        desc.innerText = 'CERRADO';
                        desc.style.color = '#ff3e3e';
                    }
                }
            } else {
                alert("âš ï¸ Error: El documento 'BOT_CONTROL/settings' no existe en tu Firebase.");
            }
        }, (error) => {
            console.error("Error en el Snapshot:", error);
            alert("âŒ Error de permisos o conexiÃ³n: " + error.message);
        });
    } catch (e) {
        console.error("Error inicial:", e);
        alert("ğŸš€ Fallo crÃ­tico al iniciar Firebase: " + e.message);
    }
</script>
