<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>‚öôÔ∏è Admin Panel | Anti-Filtras</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div id="login" style="text-align:center; padding-top: 150px;">
        <img src="../logo.webp" width="100">
        <h2>üîê ACCESO STAFF</h2>
        <input type="password" id="pass" placeholder="Contrase√±a" style="padding:12px; background:#111; color:white; border:1px solid #333; border-radius:5px;">
        <button onclick="checkPass()" style="padding:12px 20px; background:#00ff88; border:none; border-radius:5px; cursor:pointer; font-weight:bold;">ENTRAR</button>
    </div>

    <div id="panel" style="display:none;" class="container">
        <div class="admin-card" style="background:#111; padding:30px; border-radius:15px; border:1px solid #222;">
            <h2 style="text-align:center; color:#00ff88;">‚öôÔ∏è PANEL DE CONTROL</h2>
            <div id="btn-container">
                <p style="text-align:center; color:#555;">Conectando con la base de datos...</p>
            </div>
            <p style="text-align:center; margin-top:20px;"><a href="../index.html" style="color:#444; text-decoration:none;">‚¨ÖÔ∏è Volver a la Web</a></p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAEUOzOWdq0xs3qiIlX1RzB6bpKkkMLykA",
            authDomain: "antifiltras-7116d.firebaseapp.com",
            projectId: "antifiltras-7116d",
            appId: "1:795745598666:web:72b77816d3c2a3c17f8833"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.checkPass = () => {
            if(document.getElementById('pass').value === 'Antifiltras2026') {
                document.getElementById('login').style.display = 'none';
                document.getElementById('panel').style.display = 'block';
            } else { alert('‚ùå Contrase√±a Incorrecta'); }
        };

        // Escuchar cambios
        onSnapshot(doc(db, "BOT_CONTROL", "settings"), (s) => {
            const container = document.getElementById('btn-container');
            if(!s.exists()) {
                container.innerHTML = "<p style='color:red;'>‚ö†Ô∏è Error: No se encontr√≥ el documento 'settings' en Firebase.</p>";
                return;
            }
            const d = s.data();
            container.innerHTML = `
                ${renderBtn('üì© Tickets', 'ticketsEnabled', d.ticketsEnabled)}
                ${renderBtn('üö´ Baneos', 'bansEnabled', d.bansEnabled)}
                ${renderBtn('‚öôÔ∏è Config', 'configEnabled', d.configEnabled)}
            `;
        });

        window.toggleFunc = async (field, currentVal) => {
            // Rotaci√≥n: 1 -> 2 -> 0 -> 1
            let next = currentVal === 1 ? 2 : (currentVal === 2 ? 0 : 1);
            await updateDoc(doc(db, "BOT_CONTROL", "settings"), { [field]: next });
        };

        function renderBtn(label, field, val) {
            let cfg = { 
                1: {c:'#00ff88', t:'üü¢ NORMAL'}, 
                2: {c:'#ffcc00', t:'üü° MANTENIMIENTO'}, 
                0: {c:'#ff3e3e', t:'üî¥ CERRADO'} 
            }[val] || {c:'#555', t:'‚ùì ERROR'};

            return `
                <div style="display:flex; justify-content:space-between; align-items:center; padding:15px 0; border-bottom:1px solid #222;">
                    <span style="font-weight:bold;">${label}</span>
                    <button onclick="toggleFunc('${field}', ${val})" style="background:${cfg.c}; color:#000; border:none; padding:10px 20px; border-radius:5px; font-weight:bold; cursor:pointer; min-width:140px;">
                        ${cfg.t}
                    </button>
                </div>`;
        }
    </script>
</body>
</html>
