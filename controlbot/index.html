<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Master Admin | Anti-Filtras</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root { --main: #00d9ff; --bg: #020617; --card: #0f172a; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }
        
        body { 
            background: var(--bg);
            background-image: linear-gradient(rgba(0, 217, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 217, 255, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            color: #fff;
            padding: 40px;
        }

        .admin-container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 450px 1fr; gap: 30px; }

        .card { 
            background: var(--card); border: 2px solid #1e293b; padding: 30px; border-radius: 30px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); height: fit-content;
        }

        h2 { color: var(--main); margin-bottom: 25px; display: flex; align-items: center; gap: 10px; font-size: 1.5rem; }

        /* Switches de Estado */
        .control-row { 
            display: flex; justify-content: space-between; align-items: center; 
            background: #1e293b; padding: 15px 20px; border-radius: 15px; margin-bottom: 12px;
            transition: 0.3s; border: 1px solid transparent;
        }
        .control-row:hover { border-color: var(--main); background: #242f4d; }

        .btn-status { 
            border: none; padding: 10px 18px; border-radius: 10px; font-weight: 800; 
            cursor: pointer; min-width: 140px; text-transform: uppercase; font-size: 0.75rem; transition: 0.3s;
        }
        .s-1 { background: #00ff88; color: #00331a; box-shadow: 0 0 15px rgba(0,255,136,0.3); }
        .s-2 { background: #ffcc00; color: #332b00; box-shadow: 0 0 15px rgba(255,204,0,0.3); }
        .s-0 { background: #ff3e3e; color: #fff; box-shadow: 0 0 15px rgba(255,62,62,0.3); }

        /* Lista de Reportes para Staff */
        .report-log { max-height: 600px; overflow-y: auto; padding-right: 10px; }
        .report-log::-webkit-scrollbar { width: 6px; }
        .report-log::-webkit-scrollbar-thumb { background: var(--main); border-radius: 10px; }

        .log-item { 
            background: #1e293b; padding: 20px; border-radius: 18px; margin-bottom: 15px;
            border-left: 4px solid var(--main); position: relative;
        }
        .log-item b { color: var(--main); }
        .view-link { 
            display: inline-block; margin-top: 10px; color: #fff; background: rgba(0,217,255,0.2); 
            padding: 5px 12px; border-radius: 8px; text-decoration: none; font-size: 0.8rem; border: 1px solid var(--main);
        }
        .view-link:hover { background: var(--main); color: #000; }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .card { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body>

    <div class="admin-container">
        
        <div class="card">
            <h2><i class="fas fa-sliders"></i> ESTADOS DEL SISTEMA</h2>
            <div id="status-controls">
                </div>
            <p style="margin-top: 20px; font-size: 0.7rem; color: #475569; text-align: center;">
                Anti-Filtras Master Panel v2.0 | Creado por Lolo_
            </p>
        </div>

        <div class="card">
            <h2><i class="fas fa-database"></i> REPORTES POR REVISAR</h2>
            <div class="report-log" id="reports-view">
                <p style="color: #475569;">Cargando base de datos de reportes...</p>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, updateDoc, onSnapshot, collection, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyAEUOzOWdq0xs3qiIlX1RzB6bpKkkMLykA", authDomain: "antifiltras-7116d.firebaseapp.com", projectId: "antifiltras-7116d", appId: "1:795745598666:web:72b77816d3c2a3c17f8833" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 1. GESTI√ìN DE INTERRUPTORES (TODOS LOS QUE PEDISTE)
        onSnapshot(doc(db, "BOT_CONTROL", "settings"), (s) => {
            if(!s.exists()) return;
            const d = s.data();
            const controls = [
                { label: 'ü§ñ BOT CENTRAL', key: 'botEnabled' },
                { label: 'üåê WEB P√öBLICA', key: 'webEnabled' },
                { label: 'üì© SOPORTE / TICKETS', key: 'ticketsEnabled' },
                { label: 'üì° REPORTES WEB', key: 'webReportsEnabled' },
                { label: '‚öôÔ∏è CONFIGURACI√ìN', key: 'configEnabled' },
                { label: 'üö´ BANEOS GLOBALES', key: 'bansEnabled' }
            ];

            const html = controls.map(c => `
                <div class="control-row">
                    <span style="font-weight: 600; font-size: 0.9rem;">${c.label}</span>
                    <button class="btn-status s-${d[c.key]}" onclick="toggleState('${c.key}', ${d[c.key]})">
                        ${d[c.key] === 1 ? 'OPERATIVO' : d[c.key] === 2 ? 'MANTENIMIENTO' : 'APAGADO'}
                    </button>
                </div>
            `).join('');
            document.getElementById('status-controls').innerHTML = html;
        });

        // Funci√≥n para cambiar estados (C√≠clico: 1 -> 2 -> 0 -> 1)
        window.toggleState = async (field, currentVal) => {
            let newVal = currentVal === 1 ? 2 : (currentVal === 2 ? 0 : 1);
            await updateDoc(doc(db, "BOT_CONTROL", "settings"), { [field]: newVal });
        };

        // 2. VISUALIZACI√ìN DE REPORTES EN TIEMPO REAL
        onSnapshot(query(collection(db, "WEB_REPORTS"), orderBy("timestamp", "desc")), (snap) => {
            const view = document.getElementById('reports-view');
            if(snap.empty) { view.innerHTML = "<p>No hay reportes pendientes.</p>"; return; }
            
            view.innerHTML = "";
            snap.forEach(dDoc => {
                const d = dDoc.data();
                const date = d.timestamp ? new Date(d.timestamp.seconds * 1000).toLocaleString() : "Reciente";
                view.innerHTML += `
                    <div class="log-item">
                        <div style="margin-bottom: 10px; font-size: 0.85rem;">
                            <b>Usuario:</b> ${d.infractorUser} <br>
                            <b>ID:</b> <code>${d.infractorID}</code> <br>
                            <b>Fecha:</b> ${date}
                        </div>
                        <p style="font-size: 0.8rem; color: #94a3b8; border-top: 1px solid #334155; padding-top: 10px;">
                            "${d.comentario || 'Sin descripci√≥n adicional'}"
                        </p>
                        <a href="${d.evidenciaLink}" target="_blank" class="view-link">
                            <i class="fas fa-external-link-alt"></i> Ver Evidencia
                        </a>
                    </div>
                `;
            });
        });
    </script>
</body>
</html>
